{% extends "layout.html" %}


{% block title %}Listado - Pagos{% endblock %}

{% block head %}
{{ super() }}
{% endblock %}

{% block aside %}

        <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('registro_pagos.index') }}">Listado de Pagos</a>
        </li>


{% endblock %}  



{% block content %}
<style>
    body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa; /* Color de fondo suave */
    color: #333; /* Color de texto */
}

h2 {
    text-align: center;
    margin-top: 20px;
    color: #0099CC; /* Color para el título */
}

table {
    width: 80%;
    margin: 20px auto; /* Centrar la tabla */
    border-collapse: collapse; /* Eliminar espacios entre celdas */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Sombra suave */
    border-radius: 8px; /* Bordes redondeados */
    overflow: hidden; /* Para que los bordes redondeados se apliquen correctamente */
    background-color: white; /* Fondo blanco para la tabla */
}

th, td {
    padding: 12px; /* Espaciado interno */
    text-align: left; /* Alinear texto a la izquierda */
    border-bottom: 1px solid #ddd; /* Línea divisoria entre filas */
}

th {
    background-color: #0099CC; /* Color de fondo para encabezados */
    color: white; /* Color de texto para encabezados */
    font-weight: bold; /* Negrita para los encabezados */
}

tr:hover {
    background-color: #f1f1f1; /* Color de fondo al pasar el mouse */
}

tr:last-child td {
    border-bottom: none; /* Eliminar borde en la última fila */
}

/* Responsividad */
@media (max-width: 600px) {
    table {
        width: 100%; /* Hacer la tabla más pequeña en pantallas pequeñas */
    }

    th, td {
        padding: 10px; /* Reducir padding en pantallas pequeñas */
    }
}

.action-icons {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }

    .action-icons a {
        color: #0099CC;
        text-decoration: none;
        font-size: 1.2em;
    }

    .action-icons a:hover {
        color: #0099CC;
    }

    .nuevo-pago-btn {
    display: inline-block;
    padding: 10px 20px;
    font-size: 1.2em;
    background-color: #0099CC;
    color: white;
    text-align: center; /* Centrar el texto dentro del botón */
    border-radius: 8px;
    text-decoration: none;
    transition: background-color 0.3s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    
    float: left; /* Alinea el botón a la */
    margin-left: 210px;
    margin-bottom: 0px;
}

.nuevo-pago-btn:hover {
    background-color: #0099CC;
}

.search-container {
    width: 80%;
    margin: 20px auto; /* Margen superior para separación del contenido superior */
    display: flex; /* Usar flexbox para alinear elementos en fila */
    justify-content: flex-end; /* Alinear elementos al inicio */
    align-items: center; /* Alinear verticalmente los elementos al centro */
}

.search-container input[type="date"],
.search-container select,
.search-container button {
    padding: 10px; /* Espaciado interno para todos los elementos del formulario */
    font-size: 1em; /* Tamaño de fuente */
    border: 1px solid #ccc; /* Borde gris claro */
    border-radius: 5px; /* Bordes redondeados */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Sombra suave */
}

/* Estilos específicos para el botón */
.search-container button {
    background-color: #0099CC; /* Color de fondo del botón */
    color: white; /* Color de texto del botón */
    border: none; /* Sin borde */
    cursor: pointer; /* Cambia el cursor al pasar sobre el botón */
}

.search-container button:hover {
    background-color: #0099CC; /* Color de fondo al pasar el mouse */
}


    .detalles-pago {
        display: none;
        background-color: #f9f9f9;
        padding: 10px;
        margin-top: 10px;
        border-left: 4px solid #0099CC;
    }

    .mostrar-mas-btn {
        background-color: #0099CC;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .mostrar-mas-btn:hover {
        background-color: #0099CC;
    }


    h2 {
    font-size: 2rem; /* Tamaño de fuente más grande */
    color: #333; /* Color del texto */
    text-align: center; /* Centrar el texto */
    margin: 20px 0; /* Margen superior e inferior */
    font-family: 'Arial', sans-serif; /* Cambiar la fuente */
    border-bottom: 2px solid #0099CC; /* Línea debajo del título */
    padding-bottom: 10px; /* Espaciado inferior */
}

</style>

    <h2>Listado de Pagos</h2>

    

    {% if not pagos %}
    <p style="text-align: center; color: #dc3545;">No hay pagos disponibles en el listado.</p>
{% else %}

 <!-- Buscador -->
 <div class="search-container">
    <form action="{{ url_for('registro_pagos.index') }}" method="GET"  class="form-inline">
        
        <!-- Rango de fechas -->
        <input type="date" name="fecha_inicio"  placeholder="Fecha inicio">
        <input type="date" name="fecha_fin"   placeholder="Fecha fin">
        
        <!-- Tipo de pago -->
        <select name="tipo_pago" >
            <option value="">Todos los tipos</option>
            <option value="Honorarios">Honorarios</option>
            <option value="Proveedor">Proveedor</option>
            <option value="Varios">Varios</option>
        </select>
        
        <button type="submit"  class="btn btn-primary">Buscar</button>
    </form>

    <a href="{{ url_for('registro_pagos.create') }}" class="nuevo-pago-btn">Crear nuevo pago</a>

</div>

    <table>
        <thead>
            <tr>
                <th>Beneficiario</th>
                <th>Monto</th>

                <th>
                    <a href="#" onclick="ordenarPorFecha()" style="color: #f8f9fa;">Fecha 
                        <i id="orden-icon" class="fas fa-sort" style="color: #f8f9fa;"></i> 
                    </a>
                </th>

                <th>Tipo de pago</th>
                <th>Descripcion</th>
                <th>Acciones</th> 
            </tr>
        </thead>
        <tbody>
            {% for pago in pagos %}
            <tr data-id="{{ pago.id }}">
                    <td>{{ pago.beneficiario.email }}</td>
                    <td>{{ pago.monto }}</td>
                    <td>{{ pago.fecha_pago.strftime('%Y-%m-%d') }}</td>
                    <td>{{ pago.tipo_pago.tipo }}</td>
                    <td>{{ pago.descripcion }}</td>
                    <td class="action-icons">
                        <!-- Icono de edición -->
                        <a href="{{ url_for('registro_pagos.update', id=pago.id) }}" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <!-- Formulario de eliminación -->
                        <form action="{{ url_for('registro_pagos.destroy', id=pago.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este pago?');">
                            <button type="submit" title="Eliminar" style="border: none; background: none; color: #0099CC; cursor: pointer;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </form>
                         <!-- Botón de "Mostrar más" -->
                        <button class="mostrar-mas-btn" onclick="toggleDetalles({{pago.id}})">Mostrar más</button>
                    </td>
                </tr>

            <!-- Fila de detalles adicionales -->
            <tr id="detalles-{{ pago.id }}" class="detalles-pago">
                <td colspan="6">
                    <strong>Fecha de modificación:</strong> {{ pago.updated_at }}<br>
                    {% if pago.beneficiario %}
                    <strong>Datos del beneficiario:</strong> Alias - {{ pago.beneficiario.alias }}<br>
                    {% endif %}
                </td>
            </tr>

            {% endfor %}

        </tbody>
    </table>
{% endif %}

<script>
    function toggleDetalles(id) {
        var detalles = document.getElementById('detalles-' + id);
        if (detalles.style.display === 'none' || detalles.style.display === '') {
            detalles.style.display = 'table-row'; // Mostrar detalles
        } else {
            detalles.style.display = 'none'; // Ocultar detalles
        }
    }
</script>



<!--orden por fecha-->

<script>
    let ordenAscendente = true; // Inicializar la variable globalmente

    function toggleDetalles(id) {
        var detalles = document.getElementById('detalles-' + id);
        if (detalles.style.display === 'none' || detalles.style.display === '') {
            detalles.style.display = 'table-row'; // Mostrar detalles
        } else {
            detalles.style.display = 'none'; // Ocultar detalles
        }
    }

    function ordenarPorFecha() {
        const tabla = document.querySelector("table tbody");
        const filas = Array.from(tabla.querySelectorAll("tr[data-id]")); // Selecciona solo las filas principales

        // Ordenar las filas por fecha
        filas.sort((a, b) => {
            const fechaA = new Date(a.querySelector("td:nth-child(3)").innerText); // Obtener la fecha de la tercera columna
            const fechaB = new Date(b.querySelector("td:nth-child(3)").innerText);
            return ordenAscendente ? fechaA - fechaB : fechaB - fechaA; // Orden ascendente o descendente
        });

        // Actualizar el DOM con las filas ordenadas, incluyendo las filas de detalles
        filas.forEach(fila => {
            tabla.appendChild(fila); // Añadir la fila principal
            const detalles = document.getElementById('detalles-' + fila.getAttribute('data-id')); // Obtener la fila de detalles
            if (detalles) {
                tabla.appendChild(detalles); // Añadir la fila de detalles correspondiente
            }
        });

        // Cambiar el icono de orden y alternar el orden
        ordenAscendente = !ordenAscendente; // Alternar el estado de orden
        const icono = document.getElementById("orden-icon");
        if (ordenAscendente) {
            icono.classList.remove("fa-sort-down");
            icono.classList.add("fa-sort-up");
        } else {
            icono.classList.remove("fa-sort-up");
            icono.classList.add("fa-sort-down");
        }
    }
</script>






{% endblock %}
