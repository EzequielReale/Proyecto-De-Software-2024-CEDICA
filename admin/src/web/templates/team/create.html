{% extends "layout.html" %}

{% block title %}CEDICA - Nuevo miembro{% endblock %}

{% block head %} {{ super() }} {% endblock %}

{% block content %}

<h1>Crear miembro del equipo</h1>
<p>Formulario para crear un nuevo miembro del equipo</p>
<form method="post">
    <div class="form-group">
      <label for="name">Nombre:</label>
      <input type="text" class="form-control" id="name" name="name" value="{% if member and member.name %}{{ member.name }}{% endif %}" required pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" title="El nombre no debe contener números" minlength="1" maxlength="64">
    </div>
    <div class="form-group">
      <label for="last_name">Apellido:</label>
      <input type="text" class="form-control" id="last_name" name="last_name" value="{% if member and member.last_name %}{{ member.last_name }}{% endif %}" required pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" title="El apellido no debe contener números" minlength="1" maxlength="64">
    </div>
    <div class="form-group">
      <label for="dni">DNI:</label>
      <input type="text" class="form-control" id="dni" name="dni" value="{% if member and member.dni %}{{ member.dni }}{% endif %}" required pattern="\d+" title="El DNI no debe contener letras" minlength="7" maxlength="10">
    </div>
    <div class="form-group">
      <label for="phone">Teléfono:</label>
      <input type="text" class="form-control" id="phone" name="phone" value="{% if member and member.phone %}{{ member.phone }}{% endif %}" required pattern="[0-9+\-\s]+" title="El teléfono no debe contener letras" minlength="7" maxlength="32">
    </div>
    <div class="form-group">
      <label for="emergency_phone">Teléfono de emergencia:</label>
      <input type="text" class="form-control" id="emergency_phone" name="emergency_phone" value="{% if member and member.emergency_phone %}{{ member.emergency_phone }}{% endif %}" required pattern="[0-9+\-\s]+" title="El teléfono de emergencia no debe contener letras" minlength="7" maxlength="32">
    </div>
    <div class="form-group">
      <label for="street">Calle:</label>
      <input type="text" class="form-control" id="street" name="street" value="{% if member and member.street %}{{ member.street }}{% endif %}" required minlength="1" maxlength="128">
    </div>
    <div class="form-group">
      <label for="number">Número:</label>
      <input type="text" class="form-control" id="number" name="number" value="{% if member and member.number %}{{ member.number }}{% endif %}" required pattern="\d+" title="El número no debe contener letras" minlength="1" maxlength="8">
    </div>
    <div class="form-group">
      <label for="province_id">Provincia:</label>
      <select class="form-control" id="province_id" name="province_id" required>
        <option value="">Seleccione una provincia</option>
        {% for province in provinces %}
          <option value="{{ province.id }}" {% if member.locality and province.id == member.locality.province_id %}selected{% endif %}>{{ province.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      <label for="locality_id">Localidad:</label>
      <select class="form-control" id="locality_id" name="locality_id" data-selected="{{ member.locality_id }}" required>
        <option value="">Seleccione una localidad</option>
      </select>
    </div>
    <div class="form-group">
      <label for="email">Email:</label>
      <input type="email" class="form-control" id="email" name="email" value="{% if member and member.email %}{{ member.email }}{% endif %}" required>
    </div>
    <div class="form-group">
      <label for="start_date">Fecha de inicio:</label>
      <input type="date" class="form-control" id="start_date" name="start_date" value="{% if member and member.start_date %}{{ member.start_date.strftime('%Y-%m-%d') }}{% endif %}" required>
    </div>
    <div class="form-group">
      <label for="end_date">Fecha de cese:</label>
      <input type="date" class="form-control" id="end_date" name="end_date" value="{% if member and member.end_date %}{{ member.end_date.strftime('%Y-%m-%d') }}{% endif %}">
    </div>
    <div class="form-group">
      <label for="health_insurance">Obra social:</label>
      <input type="text" class="form-control" id="health_insurance" name="health_insurance" value="{% if member and member.health_insurance %}{{ member.health_insurance }}{% endif %}" required pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+" title="El nombre de la obra social no debe contener números" minlength="1" maxlength="32">
    </div>
    <div class="form-group">
      <label for="health_insurance_number">Número de la obra social:</label>
      <input type="text" class="form-control" id="health_insurance_number" name="health_insurance_number" value="{% if member and member.health_insurance_number %}{{ member.health_insurance_number }}{% endif %}" required pattern="\d+" title="El número de la obra social no debe contener letras" minlength="1" maxlength="32">
    </div>
    <div class="form-group">
      <label for="condition">Condición:</label>
      <select class="form-control" id="condition" name="condition" required>
        <option value="Voluntario" {% if member and member.condition == 'Voluntario' %}selected{% endif %}>Voluntario</option>
        <option value="Personal Rentado" {% if member and member.condition == 'Personal Rentado' %}selected{% endif %}>Personal Rentado</option>
      </select>
    </div>
    <div class="form-group">
      <label for="active">Activo:</label>
      <select class="form-control" id="active" name="active" required>
        <option value="true" {% if member and member.active %}selected{% endif %}>Sí</option>
        <option value="false" {% if member and not member.active %}selected{% endif %}>No</option>
      </select>
    </div>
    <div class="form-group">
      <label for="profession_id">Profesión:</label>
      <select class="form-control" id="profession_id" name="profession_id" required>
        {% for profession in professions %}
          <option value="{{ profession.id }}" {% if member and profession.id == member.profession_id %}selected{% endif %}>{{ profession.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      <label for="job_id">Trabajo:</label>
      <select class="form-control" id="job_id" name="job_id" required>
        {% for job in jobs %}
          <option value="{{ job.id }}" {% if member and job.id == member.job_id %}selected{% endif %}>{{ job.name }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Crear</button>
    <a href="{{ url_for('team.index') }}" class="btn btn-secondary">Cancelar</a>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var provinceId = document.getElementById('province_id').value;
    var localitySelect = document.getElementById('locality_id');
    var selectedLocalityId = localitySelect.getAttribute('data-selected');

    if (provinceId) {
        fetch('/localities/get/' + provinceId)
            .then(response => response.json())
            .then(data => {
                localitySelect.innerHTML = '<option value="">Seleccione una localidad</option>';
                data.forEach(function(locality) {
                    var option = document.createElement('option');
                    option.value = locality.id;
                    option.text = locality.name;
                    if (locality.id == selectedLocalityId) {
                        option.selected = true;
                    }
                    localitySelect.appendChild(option);
                });
            });
    }

  document.getElementById('province_id').addEventListener('change', function() {
      var provinceId = this.value;
      var localitySelect = document.getElementById('locality_id');
      localitySelect.innerHTML = '<option value="">Seleccione una localidad</option>'; // Clear existing options
  
      if (provinceId) {
          fetch('/localities/get/' + provinceId)
              .then(response => response.json())
              .then(data => {
                  data.forEach(function(locality) {
                      var option = document.createElement('option');
                      option.value = locality.id;
                      option.text = locality.name;
                      localitySelect.appendChild(option);
                  });
              });
      }
  });
});
</script>
{% endblock %}