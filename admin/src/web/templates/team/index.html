{% extends "layout.html" %}

{% block title %}CEDICA - Equipo{% endblock %}

{% block head %}
{{ super() }}
{% endblock %}

{% block content %}
<h1>Equipo</h1>
<p>Pagina de presentación del equipo</p>
<!-- Formulario de búsqueda -->
<form action="{{ url_for('team.index') }}" method="GET" class="form-inline mb-3">
  <div class="form-group mr-3">
    <label for="name">Nombre:</label>
    <input type="text" class="form-control" id="name" name="name" value="{{ filters.name or '' }}" placeholder="Nombre">
  </div>
  <div class="form-group mr-3">
    <label for="last_name">Apellido:</label>
    <input type="text" class="form-control" id="last_name" name="last_name" value="{{ filters.last_name or '' }}" placeholder="Apellido">
  </div>
  <div class="form-group mr-3">
    <label for="dni">DNI:</label>
    <input type="text" class="form-control" id="dni" name="dni" value="{{ filters.dni or '' }}" placeholder="DNI">
  </div>
  <div class="form-group mr-3">
    <label for="email">Email:</label>
    <input type="text" class="form-control" id="email" name="email" value="{{ filters.email or '' }}" placeholder="Email">
  </div>
  <div class="form-group mr-3">
    <label for="profession">Profesión:</label>
    <select class="form-control" id="profession_id" name="profession_id">
      <option value="">Seleccionar</option>
      {% for profession in professions %}
      <option value="{{ profession.id }}" {% if profession.id == filters.profession_id %}selected{% endif %}>
        {{ profession.name }}
      </option>
      {% endfor %}
    </select>
  </div>
  <button type="submit" class="btn btn-primary">Buscar</button>
  <a href="{{ url_for('team.index') }}" class="btn btn-secondary">Limpiar filtros</a>
</form>

<a href="{{ url_for('team.create') }}" class="btn btn-primary">Crear miembro nuevo</a>

<table class="table table-striped">
  <thead>
    <tr>
      <!-- Encabezado con enlaces para ordenar -->
      <th>
        <a href="{{ url_for('team.index', sort_by='name', sort_direction='asc' if sort_by != 'name' or sort_direction == 'desc' else 'desc', **filters) }}">
          Nombre
          {% if sort_by == 'name' %}
            {% if sort_direction == 'asc' %}
              &#9650; <!-- Flecha hacia arriba (ascendente) -->
            {% else %}
              &#9660; <!-- Flecha hacia abajo (descendente) -->
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>
        <a href="{{ url_for('team.index', sort_by='last_name', sort_direction='asc' if sort_by != 'last_name' or sort_direction == 'desc' else 'desc', **filters) }}">
          Apellido
          {% if sort_by == 'last_name' %}
            {% if sort_direction == 'asc' %}
              &#9650;
            {% else %}
              &#9660;
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>DNI</th>
      <th>Email</th>
      <th>Teléfono</th>
      <th>Profesión</th>
      <th>
        <a href="{{ url_for('team.index', sort_by='created_at', sort_direction='asc' if sort_by != 'created_at' or sort_direction == 'desc' else 'desc', **filters) }}">
          Fecha de Creación
          {% if sort_by == 'created_at' %}
            {% if sort_direction == 'asc' %}
              &#9650;
            {% else %}
              &#9660;
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% if members %}
    {% for member in members %}
    <tr>
      <td>{{ member.name }}</td>
      <td>{{ member.last_name }}</td>
      <td>{{ member.dni }}</td>
      <td>{{ member.email }}</td>
      <td>{{ member.phone }}</td>
      <td>{{ member.profession.name }}</td>
      <td>{{ member.created_at.strftime('%Y-%m-%d') }}</td>
      <td>
        <a href="{{ url_for('team.show', id=member.id) }}" class="btn btn-info">Ver</a>
      </td>
    </tr>
    {% endfor %}
    {% else %}
    <tr>
      <td colspan="8">No hay miembros en el equipo</td>
    </tr>
    {% endif %}
  </tbody>
</table>


<!-- Acá se realiza la paginación -->
<nav aria-label="Page navigation">
  <ul class="pagination">
    {% if page > 1 %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('team.index', page=page-1, **filters) }}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    {% endif %}
    {% for p in range(1, total_pages + 1) %}
    <li class="page-item {% if p == page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('team.index', page=p, **filters) }}">{{ p }}</a>
    </li>
    {% endfor %}
    {% if page < total_pages %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('team.index', page=page+1, **filters) }}" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endblock %}

{% block footer %}
{% endblock %}