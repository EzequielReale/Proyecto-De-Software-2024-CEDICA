{% extends "layout.html" %}

{% block title %}Registro de caballos{% endblock %}
{% block head %}
{{ super() }}
<style>
    .form-group label {
        font-weight: 500;
    }

    a,
    a:hover {
        text-decoration: none !important;
    }

    #btn-back {
        transition: 0.2s;
        color: #222 !important;
    }

    #btn-back:hover {
        background-color: #ddd !important;
    }

    #activities-list li {
        transition: 0.2s;
    }

    #activities-list li:hover {
        background-color: #f0f0f0;
    }

    .selected {
        background-color: #0077AA !important;
        color: white !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>游냁 Registro de caballos</h2>
    <form class="d-flex flex-column gap-3 mt-4" action="{{ url_for('registro_pagos.create') }}" method="POST">
        <div class="form-group">
            <label class="mb-1" for="name">Nombre</label>
            <input class="form-control" type="text" id="name" name="name" placeholder="Ingrese el nombre del caballo"
                required maxlength="64">
        </div>

        <div class="w-100 d-flex flex-row gap-3">
            <div class="form-group w-50">
                <label class="mb-1" for="birth_date">Nacimiento</label>
                <input class="form-control" type="date" id="birth_date" name="birth_date" required>
            </div>
            <div class="form-group w-50">
                <label class="mb-1" for="entry_date">Fecha de ingreso</label>
                <input class="form-control" type="date" id="entry_date" name="entry_date" required>
            </div>
        </div>

        <div class="form-group">
            <label class="mb-1" for="gender">Sexo</label>
            <select class="form-select" name="gender" id="gender" required>
                <option selected>Seleccione una opci칩n...</option>
                <option value="0">Macho</option>
                <option value="1">Hembra</option>
            </select>
        </div>

        <div class="form-group w-100 d-flex flex-row gap-3">
            <div class="w-50">
                <label class="mb-1" for="race">Raza</label>
                <input id="race" name="race" placeholder="Ingrese la raza del caballo" type="text" class="form-control"
                    required maxlength="32">
            </div>
            <div class="w-50">
                <label class="mb-1" for="coat">Pelaje</label>
                <input id="coat" name="coat" placeholder="Ingrese el pelaje del caballo" type="text"
                    class="form-control" required maxlength="32">
            </div>
        </div>

        <div class="form-group">
            <label for="activities">Actividades asignadas</label>
            <div class="form-text mt-0 mb-2">
                Seleccione las actividades que se le asignar치n al caballo.
            </div>
            <ul id="activities-list"
                class="p-0 d-flex gap-3 flex-wrap w-100 align-items-center justify-content-center text-center">
                {% if activities %}
                {% for activity in activities %}
                <li id="activity-{{activity.id}}" class="list-group-item border rounded py-1"
                    onclick="toggleSelected({{activity.id}})" style="flex-grow: 1;" role="button">{{
                    activity.name }}</li>
                {% endfor %}
                {% endif %}
            </ul>
        </div>

        <!-- Campo oculto para enviar las actividades seleccionadas al form -->
        <input type="hidden" name="selected_activities" id="selected-activities-input">

        <div class="d-flex flex-row align-items-center justify-content-between w-100 mt-1">
            <a id="btn-back" class="btn border border-2" href="{{ url_for('ecuestre.index') }}">
                <i style="transform: scale(0.6);" class="fa fa-chevron-left me-1"></i>
                Volver</a>
            <button class="btn btn-primary" type="submit">Registrar caballo</button>
        </div>
    </form>
</div>

<script>
    // Evento que se ejecuta cuando se termina de cargar el DOM y establece la fecha m치xima en el campo de fecha de nacimiento.
    document.addEventListener('DOMContentLoaded', function () {
        // Obtener la fecha actual en formato YYYY-MM-DD
        var today = new Date().toISOString().split('T')[0];
        // Establecer el atributo max del campo de fecha de nacimiento
        document.getElementById('birth_date').setAttribute('max', today);
    });

    // Lista de actividades seleccionadas
    const selectedActivities = [];

    // Funci칩n para alternar la clase 'selected' en los elementos de la lista de actividades
    function toggleSelected(id) {
        // Obtener el elemento de la lista de actividades
        const element = document.getElementById('activity-' + id);

        // Alternar la clase 'selected' y agregar o eliminar el ID de la actividad de la lista
        if (element.classList.toggle('selected')) {
            selectedActivities.push(id);
        } else {
            selectedActivities.splice(selectedActivities.indexOf(id), 1);
        }
    }

    // Evento para actualizar el campo oculto antes de enviar el formulario
    document.getElementById('horse-form').addEventListener('submit', function () {
        document.getElementById('selected-activities-input').value = JSON.stringify(selectedActivities);
    });
</script>
{% endblock %}